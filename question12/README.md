# Билет №12. Алгоритмы поиска подстроки. Простейший поиск. Алгоритм Рабина – Карпа.

**Определение:** Алгоритм поиска подстроки в строке с использованием хэширования.  
**Суть простыми словами:** Берем хеш паттерна (искомой подстроки), берем хеш куска текста равного по длине, сравниваем их. Если равны, то проверяем их посимвольно, в противном случае — идем дальше.
## Основные термины и обозначения
- **Строка** - набор символов, среди которых производится поиск.  
- **Подстрока** - непустая часть строки, которую необходимо найти в строке.
- **Алгоритм Рабина - Карпа** - Алгоритм поиска подстроки в строке.

## Псевдокод

```python
 1 function RabinKarp(string s[1..n], string sub[1..m])
 2     hsub := hash(sub[1..m])        # Вычисляем значение хеша подстроки
 3     hs := hash(s[1..m])            # Вычисляем значение хеша части строки, равной по длине подстроке.
 4     for i from 1 to (n-m+1)        # Рассматриваем все части строки, совпадающие по длине с подстрокой.
 5         if hs = hsub               # Если значения хеш-функций совпадают, то сравниваем
 6             if s[i..i+m-1] = sub   # подстроку и текущую часть строки и возращаем значение i,
 7                 return i           # если строки совпадают.
 8         hs := hash(s[i+1..i+m])    # Вычисляем значение хеша части строки, начиная с текущего символа.
 9     return not found               # Если ни одна часть строки не совпала с подстрокой, возвращаем not found.
 10
 11 function hash(m,s)
 12    b = const
 13     q = const
 14    hash = 0
 15    for i from 1 to m   
 16        hash= hash + s[i]*b^(m-i) mod q
 17    return hash
```
## Псевдокод(Воронов)

```python
d – основание системы счисления (число цифр в алфавите)
q – простое число
Вычисление p и t0:
h = d^(m-1) mod q
p = 0
t = 0
for i = 1 to m do
{
   p = (d*p + P[i]) mod q
   t = (d*t + T[i]) mod q
}
Основная часть:
for s = 0 to n – m do
{
   if p = t then
   {
      i = 1
      while (i ≤ m) and (P[i] = T[s+i]) do
         i++
      if i > m then
         print “Строка входит со сдвигом” s
   }
   if s < n – m then
      t = (d*(t-T[s+1]*h)+T[s+m+1]) mod q
}


```

## Пример 

- Пример работы алгоритма для подстроки "hel" и текста "hello"

![](https://github.com/PetrSU-IMIT-2020/algo/blob/main/question12/images/ex1.png)

![](https://github.com/PetrSU-IMIT-2020/algo/blob/main/question12/images/ex2.png)

![](https://github.com/PetrSU-IMIT-2020/algo/blob/main/question12/images/ex3.png)

## Вычисление хэша

- Самый простой вариант хэш функции - полиномиальный:  
$H=C_1 * b^{m-1} + C_2 * b^{m-2} + C_3 * b^{m-3} + ... + C_m * b^0$,  
Где  
C1 ... Cm - код соответствующих символов подстроки  
b - некая константа (можно взять любое число)  
m - длина искомой подстроки  

- *Пример:*  
b = 10, h = 1, e = 2, l = 3, o = 4  
m = 5  
$H(hello) = 1 * 10^4 + 2 * 10^3 + 3 * 10^2 + 3 * 10^1 + 4 * 10^0 = 10000 + 2000 + 300 + 30 + 4 = 12334$

## Метод Хорнера
*На всякий случай расписал, так просто считать удобнее*  

Когда у нас уже есть Хэш для определенной части искомого текста, то чтобы перейти к следующему символу, не нужно считать полностью хэш заново.
Достаточно просто от имеющегося хэша отнять $C_1 * b^{m-1}$, умножить оставшееся число на $b$ и добавить $C_m$ (тут $C_m$ - это хэш нового символа).

- *Пример:*  
b = 10, h = 1, e = 2, l = 3, o = 4 
Допустим, искомая подстрока длины 3 в строке hello (не важно, какая именно подстрока), тогда считаем хэш первых трех символов для строки в которой ищем:  
$hel = 1 * 10^2 + 2 * 10^1 + 3 * 10^0 = 123$  
Так как мы "ползем" по строке и сверяем хэши, то далее надо посчитать хэш подстроки ell, это можно сделать быстрее, используя метод Хорнера:  
$ell = (H(hel) - h * b^{m-1}) * b + l = (123 - 10 * 10) * 10 + 3 = 233$

## Временная сложность

- Работает в худшем случае за время:  
$O(n * m)$,    
где n - длина строки, m - длина подстроки

## Создатель

Автор расписанного билета: Топчий Женя и Смирнов Костя

Кто проверил: 

 - Курочкин Дима
 - Квист Татьяна

## Ресурсы
- [Видос на ютубе](https://www.youtube.com/watch?v=k-yHiGuNxNo)  
- [Вики](https://ru.wikipedia.org/wiki/Алгоритм_Рабина_—_Карпа#:~:text=Алгоритм%20Рабина%20—%20Карпа%20—%20это%20алгоритм,Майклом%20Рабином%20и%20Ричардом%20Карпом.)
 
